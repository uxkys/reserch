<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Shape Puzzle Game (400x225 center / 50 levels fixed)</title>
  <style>
    /* ======== 全体レイアウト ======== */
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background-color: #f0f0f0;
      position: relative;
    }

    /* ======== ゲーム表示領域（画面下部のボタン領域考慮） ======== */
    #game-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      background-color: #fff;
      border-bottom: 2px solid #ccc;
      margin-bottom: 96px; /* ボタン高さ80px＋隙間16px */
    }

    /* -- 中央に 400x225 のエリアを配置 -- */
    #puzzle-area {
      position: absolute;
      width: 400px;
      height: 225px;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      border: 2px dashed #999;
      background: #fafafa;
      /* overflow: hidden; 必要ならコメントアウト解除 */
    }

    /* レベル表示 (左上) */
    #level-display {
      position: absolute;
      font-size: 18px;
      background: rgba(255,255,255,0.7);
      padding: 5px 10px;
      border-radius: 5px;
      z-index: 1000;
      left: 70px; 
      top: 10px;  
    }

    /* タイマー表示 (右上) */
    #timer-display {
      position: absolute;
      font-size: 18px;
      background: rgba(255,255,255,0.7);
      padding: 5px 10px;
      border-radius: 5px;
      z-index: 1000;
      right: 10px;
      top: 10px;
    }

    /* ======== スタート画面コンテナ ======== */
    #start-screen {
      position: absolute;
      z-index: 9999; /* 最前面に表示 */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background-color: #fff;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    #start-screen label {
      font-size: 14px;
    }
    #start-btn {
      margin-top: 10px;
      font-size: 16px;
      padding: 8px 16px;
      cursor: pointer;
    }

    /* CSVダウンロードボタン (画面右下) */
    #csv-download-btn {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 16px;
      padding: 10px;
      cursor: pointer;
      display: none;
      z-index: 2000;
    }
    /* リスタートボタン (画面左下) */
    #restart-btn {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 16px;
      padding: 10px;
      cursor: pointer;
      display: none;
      z-index: 2000;
    }

    /* ======== GoodUIボタンのコンテナ (画面下部いっぱい) ======== */
    #button-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      background-color: #ddd; /* グレー背景 */
      z-index: 1200;
    }

    .btn-wrapper {
      text-align: center;
    }
    .btn-wrapper button {
      display: inline-block;
      width: 60px;
      height: 60px;
      line-height: 60px;
      text-align: center;
      cursor: pointer;
      border: 2px solid #333;
      border-radius: 8px;
      background: #fff;
      font-size: 32px;
    }
    .btn-wrapper[data-shape="▲"] button,
    .btn-wrapper[data-shape="★"] button {
      font-size: 24px; /* ▲と★は少し小さめ */
    }

    /* ======== 画面上の図形 ( puzzle-area 内に配置 ) ======== */
    .shape {
      position: absolute;
      font-size: 24px;
      user-select: none;
      cursor: default; /* クリック無効 */
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
    }

    /* ======== ハンバーガーメニュー ======== */
    #hamburger-menu {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1301;
      font-size: 24px;
      background: rgba(255,255,255,0.7);
      border: none;
      cursor: pointer;
      width: 40px;
      height: 40px;
      text-align: center;
    }
    #menu-panel {
      position: absolute;
      top: 0;
      left: 0;
      width: 200px;
      background: #aaa;
      color: #fff;
      padding: 10px;
      transform: translateX(-220px);
      transition: transform 0.3s ease;
      z-index: 1300;
      height: 100vh;
    }
    #menu-panel.open {
      transform: translateX(0);
    }
    #toggle-ui-btn {
      display: block;
      margin: 20px auto;
      width: 40px;
      height: 40px;
      background: #666;
      border: none;
      cursor: pointer;
    }
    #close-menu-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: 1px solid #fff;
      color: #fff;
      cursor: pointer;
      font-size: 16px;
      width: 30px;
      height: 30px;
      text-align: center;
    }

    /* ======== モーダル (BadUI) ======== */
    #modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #333;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    #modal-content {
      background: #fff;
      padding: 20px;
      min-width: 200px;
      border-radius: 8px;
      text-align: center;
      position: relative;
    }
    #modal-content h2 {
      margin-top: 0;
    }
    /* ボタン枠をなくす */
    .badui-shape-btn,
    .confirm-btn {
      margin: 10px;
      cursor: pointer;
      border: none; /* 枠線をなくす */
      background: #eee;
      padding: 5px 10px;
    }
    .highlight {
      background: green;
      color: #fff;
    }
    .font16 {
      font-size: 16px;
    }
    .font12 {
      font-size: 12px;
    }

    #badui-shape-container {
      margin-bottom: 10px;
    }
    #confirm-container {
      display: none;
      margin-top: 10px;
    }

    /* BadUI用: 「Answer」ボタン */
    #badui-answer-button-container {
      display:none; 
      text-align:center; 
      padding:10px; 
      background:#ddd;
      position: static;
    }
    #answer-btn {
      padding:10px 20px; 
      cursor:pointer;
      border: none; /* 枠線不要 */
      background: #ccc;
    }

    /* ======== トースト通知 (GoodUI用) ========
       右側に配置し、button-containerと被らないよう
       bottomを(80px+16px=)96px程度にして隙間を開ける */
    #toast {
      position: fixed;
      right: 10px;
      bottom: 96px; 
      background: rgba(0,0,0,0.2);
      color: #fff;
      padding: 10px;
      border-radius: 4px;
      display: none;
      font-size: 24px;
      z-index: 9999;
    }
  </style>
</head>
<body>

<!-- ハンバーガーメニュー（左上） -->
<button id="hamburger-menu">
  &#9776; <!-- 三本線アイコン -->
</button>
<!-- メニュー展開パネル -->
<div id="menu-panel">
  <button id="close-menu-btn">×</button>
  <button id="toggle-ui-btn"></button>
</div>

<!-- スタート画面 (プレイ時間指定 + Startボタン) -->
<div id="start-screen">
  <label for="play-time">プレイ時間(秒):</label>
  <input type="number" id="play-time" value="180" min="10" max="9999" style="width:80px; margin:0 10px;">
  <br><br>
  <button id="start-btn">Start</button>
</div>

<!-- ゲーム領域（中央にパズルエリア 400x225） -->
<div id="game-container">
  <div id="level-display"></div>
  <div id="timer-display"></div>

  <!-- 図形を配置する中央の固定エリア -->
  <div id="puzzle-area"></div>
</div>

<!-- GoodUIの回答ボタン群 -->
<div id="button-container">
  <!-- Order: ●, ▲, ■, ★ -->
  <div class="btn-wrapper" data-shape="●">
    <button data-shape="●">●</button>
  </div>
  <div class="btn-wrapper" data-shape="▲">
    <button data-shape="▲">▲</button>
  </div>
  <div class="btn-wrapper" data-shape="■">
    <button data-shape="■">■</button>
  </div>
  <div class="btn-wrapper" data-shape="★">
    <button data-shape="★">★</button>
  </div>
</div>

<!-- BadUI用: 「Answer」ボタン -->
<div id="badui-answer-button-container">
  <button id="answer-btn">Answer</button>
</div>

<!-- モーダル: BadUIで形ボタンを選ばせる -->
<div id="modal-overlay">
  <div id="modal-content">
    <h2>どの形を選びますか？</h2>
    <div id="badui-shape-container"></div>
    <div id="confirm-container">
      <p>この回答でよろしいですか？</p>
      <button class="confirm-btn" data-choice="go">go</button>
      <button class="confirm-btn" data-choice="no">no</button>
      <button class="confirm-btn" data-choice="return">return</button>
    </div>
  </div>
</div>

<!-- CSVダウンロード & リスタートボタン -->
<button id="csv-download-btn">Download CSV</button>
<button id="restart-btn">Restart</button>

<!-- トースト通知 (GoodUI用) -->
<div id="toast"></div>

<script>
  /* ================================
     グローバル設定・変数
  =================================*/
  const SHAPES = ["●","▲","■","★"];
  const totalLevels = 50; 
  let currentLevel = 1;
  let correctShape = "";
  let levelStartTime = 0;
  let sessionActive = false;
  let timerInterval = null;
  let isBadUI = false; // 現在のUIモード(false = GoodUI, true = BadUI)

  // 画面要素の参照
  const gameContainer = document.getElementById('game-container');
  const puzzleArea = document.getElementById('puzzle-area');
  const levelDisplay = document.getElementById('level-display');
  const timerDisplay = document.getElementById('timer-display');
  const startScreen = document.getElementById('start-screen');
  const playTimeInput = document.getElementById('play-time');
  const startBtn = document.getElementById('start-btn');
  const csvDownloadBtn = document.getElementById('csv-download-btn');
  const restartBtn = document.getElementById('restart-btn');
  const hamburgerMenuBtn = document.getElementById('hamburger-menu');
  const menuPanel = document.getElementById('menu-panel');
  const closeMenuBtn = document.getElementById('close-menu-btn');
  const toggleUIBtn = document.getElementById('toggle-ui-btn');
  const baduiAnswerContainer = document.getElementById('badui-answer-button-container');
  const answerBtn = document.getElementById('answer-btn');
  const modalOverlay = document.getElementById('modal-overlay');
  const baduiShapeContainer = document.getElementById('badui-shape-container');
  const confirmContainer = document.getElementById('confirm-container');
  const toast = document.getElementById('toast');
  const buttons = document.querySelectorAll('#button-container button');

  // CSV出力用データ
  let sessionData = {
    playCount: 0,
    sessionStart: null,
    sessionEnd: null,
    levels: []  // { level: n, clearTime: ms, mode: "GoodUI" or "BadUI" }
  };

  /* ================================
     問題データ(全50レベル分)を固定化
     - correctShape: 正解の図形
     - shapes: 画面に配置する図形( shape, x, y )の配列
       ※ x,y は #puzzle-area (400x225) 内の絶対座標
  =================================*/
//////////////////////////////////////////////
// 座標リスト (x,y) : index=1～16
//////////////////////////////////////////////
const coords = [
  { x:  60, y:  20 },  // index=1
  { x: 140, y:  20 },  // index=2
  { x: 220, y:  20 },  // index=3
  { x: 300, y:  20 },  // index=4
  { x:  60, y:  70 },  // index=5
  { x: 140, y:  70 },  // index=6
  { x: 220, y:  70 },  // index=7
  { x: 300, y:  70 },  // index=8
  { x:  60, y: 120 },  // index=9
  { x: 140, y: 120 },  // index=10
  { x: 220, y: 120 },  // index=11
  { x: 300, y: 120 },  // index=12
  { x:  60, y: 170 },  // index=13
  { x: 140, y: 170 },  // index=14
  { x: 220, y: 170 },  // index=15
  { x: 300, y: 170 },  // index=16
];

//////////////////////////////////////////////
// puzzleData : レベル1～30
//////////////////////////////////////////////
const puzzleData = [
  // -----------------------------------------------------------
  // Level1 (diff=5) : (10,5,1) [3種類のみ使用]
  //   correctShape = "●"
  //   分布: 「●×10, ▲×5, ■×1」 (★は不使用)
  // -----------------------------------------------------------
  {
    level: 1,
    correctShape: "●",
    shapes: [
      // "●" x 10
      { shape: "●", ...coords[0] },  // index=1  (60,20)
      { shape: "●", ...coords[1] },  // index=2  (140,20)
      { shape: "●", ...coords[2] },  // index=3  (220,20)
      { shape: "●", ...coords[5] },  // index=6  (140,70)
      { shape: "●", ...coords[7] },  // index=8  (300,70)
      { shape: "●", ...coords[8] },  // index=9  (60,120)
      { shape: "●", ...coords[10] }, // index=11 (220,120)
      { shape: "●", ...coords[11] }, // index=12 (300,120)
      { shape: "●", ...coords[13] }, // index=14 (140,170)
      { shape: "●", ...coords[15] }, // index=16 (300,170)
      // "▲" x 5
      { shape: "▲", ...coords[3] },  // index=4  (300,20)
      { shape: "▲", ...coords[4] },  // index=5  (60,70)
      { shape: "▲", ...coords[6] },  // index=7  (220,70)
      { shape: "▲", ...coords[9] },  // index=10 (140,120)
      { shape: "▲", ...coords[12] }, // index=13 (60,170)
      // "■" x 1
      { shape: "■", ...coords[14] }, // index=15 (220,170)
    ]
  },

  // -----------------------------------------------------------
  // Level2 (diff=5) : (10,5,1) [3種類のみ使用]
  //   correctShape = "▲"
  //   分布: 「▲×10, ■×5, ★×1」 (●は不使用)
  // -----------------------------------------------------------
  {
    level: 2,
    correctShape: "▲",
    shapes: [
      // "▲" x 10
      { shape: "▲", ...coords[0] },  // (60,20)
      { shape: "▲", ...coords[1] },  // (140,20)
      { shape: "▲", ...coords[2] },  // (220,20)
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[11] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      // "■" x 5
      { shape: "■", ...coords[3] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[12] },
      // "★" x 1
      { shape: "★", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level3 (diff=4) : (8,4,2,2)
  //   correctShape = "★"
  //   分布: 「★×8, ●×4, ▲×2, ■×2」
  // -----------------------------------------------------------
  {
    level: 3,
    correctShape: "★",
    shapes: [
      // "★" x 8
      { shape: "★", ...coords[0] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[15] },
      // "●" x 4
      { shape: "●", ...coords[1] },
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[9] },
      // "▲" x 2
      { shape: "▲", ...coords[11] },
      { shape: "▲", ...coords[12] },
      // "■" x 2
      { shape: "■", ...coords[3] },
      { shape: "■", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level4 (diff=4) : (8,4,2,2)
  //   correctShape = "■"
  //   分布: 「■×8, ★×4, ●×2, ▲×2」
  // -----------------------------------------------------------
  {
    level: 4,
    correctShape: "■",
    shapes: [
      // "■" x 8
      { shape: "■", ...coords[0] },  // (60,20)
      { shape: "■", ...coords[2] },  // (220,20)
      { shape: "■", ...coords[5] },  // (140,70)
      { shape: "■", ...coords[7] },  // (300,70)
      { shape: "■", ...coords[8] },  // (60,120)
      { shape: "■", ...coords[10] }, // (220,120)
      { shape: "■", ...coords[13] }, // (140,170)
      { shape: "■", ...coords[15] }, // (300,170)
      // "★" x 4
      { shape: "★", ...coords[1] },  // (140,20)
      { shape: "★", ...coords[4] },  // (60,70)
      { shape: "★", ...coords[6] },  // (220,70)
      { shape: "★", ...coords[9] },  // (140,120)
      // "●" x 2
      { shape: "●", ...coords[11] }, // (300,120)
      { shape: "●", ...coords[12] }, // (60,170)
      // "▲" x 2
      { shape: "▲", ...coords[3] },  // (300,20)
      { shape: "▲", ...coords[14] }, // (220,170)
    ]
  },

  // -----------------------------------------------------------
  // Level5 (diff=4) : (8,4,2,2)
  //   correctShape = "●"
  //   分布: 「●×8, ▲×4, ■×2, ★×2」
  // -----------------------------------------------------------
  {
    level: 5,
    correctShape: "●",
    shapes: [
      // "●" x 8
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[10] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[15] },
      // "▲" x 4
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[9] },
      // "■" x 2
      { shape: "■", ...coords[11] },
      { shape: "■", ...coords[12] },
      // "★" x 2
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level6 (diff=4) : (8,4,2,2)
  //   correctShape = "▲"
  //   分布: 「▲×8, ■×4, ★×2, ●×2」
  // -----------------------------------------------------------
  {
    level: 6,
    correctShape: "▲",
    shapes: [
      // "▲" x 8
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[2] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      // "■" x 4
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      // "★" x 2
      { shape: "★", ...coords[11] },
      { shape: "★", ...coords[12] },
      // "●" x 2
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level7 (diff=3) : (7,4,4,1)
  //   correctShape = "●"
  //   分布: 「●×7, ▲×4, ■×4, ★×1」
  // -----------------------------------------------------------
  {
    level: 7,
    correctShape: "●",
    shapes: [
      // "●" x 7
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[15] },
      // "▲" x 4
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      // "■" x 4
      { shape: "■", ...coords[2] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[12] },
      // "★" x 1
      { shape: "★", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level8 (diff=3) : (7,4,4,1)
  //   correctShape = "■"
  //   分布: 「■×7, ★×4, ●×4, ▲×1」
  // -----------------------------------------------------------
  {
    level: 8,
    correctShape: "■",
    shapes: [
      // "■" x 7
      { shape: "■", ...coords[0] },   // index=1  (60,20)
      { shape: "■", ...coords[3] },   // index=4  (300,20)
      { shape: "■", ...coords[6] },   // index=7  (220,70)
      { shape: "■", ...coords[8] },   // index=9  (60,120)
      { shape: "■", ...coords[11] },  // index=12 (300,120)
      { shape: "■", ...coords[13] },  // index=14 (140,170)
      { shape: "■", ...coords[15] },  // index=16 (300,170)
      // "★" x 4
      { shape: "★", ...coords[1] },   // (140,20)
      { shape: "★", ...coords[5] },   // (140,70)
      { shape: "★", ...coords[7] },   // (300,70)
      { shape: "★", ...coords[9] },   // (140,120)
      // "●" x 4
      { shape: "●", ...coords[2] },   // (220,20)
      { shape: "●", ...coords[4] },   // (60,70)
      { shape: "●", ...coords[10] },  // (220,120)
      { shape: "●", ...coords[12] },  // (60,170)
      // "▲" x 1
      { shape: "▲", ...coords[14] },  // (220,170)
    ]
  },

  // -----------------------------------------------------------
  // Level9 (diff=3) : (7,4,4,1)
  //   correctShape = "★"
  //   分布: 「★×7, ●×4, ▲×4, ■×1」
  // -----------------------------------------------------------
  {
    level: 9,
    correctShape: "★",
    shapes: [
      // "★" x 7
      { shape: "★", ...coords[0] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[6] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[11] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[15] },
      // "●" x 4
      { shape: "●", ...coords[1] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[9] },
      // "▲" x 4
      { shape: "▲", ...coords[2] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[12] },
      // "■" x 1
      { shape: "■", ...coords[14] },
    ]
  },


  // -----------------------------------------------------------
  // Level10 (diff=3) : (7,4,4,1)
  //   correctShape = "▲"
  //   分布: 「▲×7, ■×4, ★×4, ●×1」
  // -----------------------------------------------------------
  {
    level: 10,
    correctShape: "▲",
    shapes: [
      // "▲" x 7
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[11] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      // "■" x 4
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[5] },
      { shape: "■", ...coords[7] },
      { shape: "■", ...coords[9] },
      // "★" x 4
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[12] },
      // "●" x 1
      { shape: "●", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level11 (diff=3) : (7,4,4,1)
  //   correctShape = "■"
  //   分布: 「■×7, ★×4, ●×4, ▲×1」
  // -----------------------------------------------------------
  {
    level: 11,
    correctShape: "■",
    shapes: [
      // "■" x 7
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[3] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[8] },
      { shape: "■", ...coords[11] },
      { shape: "■", ...coords[13] },
      { shape: "■", ...coords[15] },
      // "★" x 4
      { shape: "★", ...coords[1] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[9] },
      // "●" x 4
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[10] },
      { shape: "●", ...coords[12] },
      // "▲" x 1
      { shape: "▲", ...coords[14] },
    ]
  },
  
  // -----------------------------------------------------------
  // Level12 (diff=3) : (7,4,4,1)
  //   correctShape = "●"
  //   分布: 「●×7, ▲×4, ■×4, ★×1」
  // -----------------------------------------------------------
  {
    level: 12,
    correctShape: "●",
    shapes: [
      // "●" x 7
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[15] },
      // "▲" x 4
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      // "■" x 4
      { shape: "■", ...coords[2] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[12] },
      // "★" x 1
      { shape: "★", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // Level13 (diff=3) : (7,4,4,1)
  //   correctShape = "★"
  //   分布: 「★×7, ●×4, ▲×4, ■×1」
  // -----------------------------------------------------------
  {
    level: 13,
    correctShape: "★",
    shapes: [
      // "★" x 7
      { shape: "★", ...coords[0] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[6] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[11] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[15] },
      // "●" x 4
      { shape: "●", ...coords[1] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[9] },
      // "▲" x 4
      { shape: "▲", ...coords[2] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[12] },
      // "■" x 1
      { shape: "■", ...coords[14] },
    ]
  },


  // -----------------------------------------------------------
  // Level14 (diff=3) : (7,4,4,1)
  //   correctShape = "▲"
  //   分布: 「▲×7, ■×4, ★×4, ●×1」
  // -----------------------------------------------------------
  {
    level: 14,
    correctShape: "▲",
    shapes: [
      // "▲" x 7
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[11] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      // "■" x 4
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[5] },
      { shape: "■", ...coords[7] },
      { shape: "■", ...coords[9] },
      // "★" x 4
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[12] },
      // "●" x 1
      { shape: "●", ...coords[14] },
    ]
  },

  // -----------------------------------------------------------
  // ここからレベル15～30 (diff=2: (6,4,4,2))
  // 前回のロジックどおり、levelを付与してそのまま接続
  // -----------------------------------------------------------

  // --------------------------
  // Level15 (correct = ■)
  // --------------------------
  {
    level: 15,
    correctShape: "■",
    shapes: [
      // ■ × 6 → [1,2,7,10,13,16]
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[12] },
      { shape: "■", ...coords[15] },
      // ★ × 4 → [3,4,8,11]
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[10] },
      // ● × 4 → [5,9,14,15]
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[14] },
      // ▲ × 2 → [6,12]
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[11] },
    ]
  },

  // --------------------------
  // Level16 (correct = ●)
  // --------------------------
  {
    level: 16,
    correctShape: "●",
    shapes: [
      // ● × 6 → [3,4,6,8,13,14]
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[12] },
      { shape: "●", ...coords[13] },
      // ▲ × 4 → [2,7,9,16]
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[15] },
      // ■ × 4 → [1,5,10,12]
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[11] },
      // ★ × 2 → [11,15]
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[14] },
    ]
  },
  
  // --------------------------
  // Level17 (correct = ★)
  // --------------------------
  {
    level: 17,
    correctShape: "★",
    shapes: [
      // ★ × 6 → [2,3,6,9,14,15]
      { shape: "★", ...coords[1] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[14] },
      // ● × 4 → [1,4,7,16]
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[15] },
      // ▲ × 4 → [5,8,10,13]
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      { shape: "▲", ...coords[12] },
      // ■ × 2 → [11,12]
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[11] },
    ]
  },


  // --------------------------
  // Level18 (correct = ▲)
  // --------------------------
  {
    level: 18,
    correctShape: "▲",
    shapes: [
      // ▲ × 6 → [1,4,6,11,14,16]
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      // ■ × 4 → [2,7,9,13]
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[8] },
      { shape: "■", ...coords[12] },
      // ★ × 4 → [3,5,8,10]
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[9] },
      // ● × 2 → [12,15]
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[14] },
    ]
  },

  // --------------------------
  // Level19 (correct = ■)
  // --------------------------
  {
    level: 19,
    correctShape: "■",
    shapes: [
      // 同パターン (correct=■)
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[12] },
      { shape: "■", ...coords[15] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[10] },
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[14] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[11] },
    ]
  },

  // --------------------------
  // Level20 (correct = ●)
  // --------------------------
  {
    level: 20,
    correctShape: "●",
    shapes: [
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[12] },
      { shape: "●", ...coords[13] },
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[11] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[14] },
    ]
  },

  // --------------------------
  // Level21 (correct = ★)
  // --------------------------
  {
    level: 21,
    correctShape: "★",
    shapes: [
      { shape: "★", ...coords[1] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[14] },
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[15] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      { shape: "▲", ...coords[12] },
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[11] },
    ]
  },

  // --------------------------
  // Level22 (correct = ▲)
  // --------------------------
  {
    level: 22,
    correctShape: "▲",
    shapes: [
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[8] },
      { shape: "■", ...coords[12] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[9] },
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[14] },
    ]
  },

  // --------------------------
  // Level23 (correct = ■)
  // --------------------------
  {
    level: 23,
    correctShape: "■",
    shapes: [
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[12] },
      { shape: "■", ...coords[15] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[10] },
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[14] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[11] },
    ]
  },

  // --------------------------
  // Level24 (correct = ●)
  // --------------------------
  {
    level: 24,
    correctShape: "●",
    shapes: [
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[12] },
      { shape: "●", ...coords[13] },
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[11] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[14] },
    ]
  },

  // --------------------------
  // Level25 (correct = ★)
  // --------------------------
  {
    level: 25,
    correctShape: "★",
    shapes: [
      { shape: "★", ...coords[1] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[14] },
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[15] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      { shape: "▲", ...coords[12] },
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[11] },
    ]
  },

  // --------------------------
  // Level26 (correct = ▲)
  // --------------------------
  {
    level: 26,
    correctShape: "▲",
    shapes: [
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[8] },
      { shape: "■", ...coords[12] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[9] },
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[14] },
    ]
  },

  // --------------------------
  // Level27 (correct = ■)
  // --------------------------
  {
    level: 27,
    correctShape: "■",
    shapes: [
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[12] },
      { shape: "■", ...coords[15] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[3] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[10] },
      { shape: "●", ...coords[4] },
      { shape: "●", ...coords[8] },
      { shape: "●", ...coords[13] },
      { shape: "●", ...coords[14] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[11] },
    ]
  },

  // --------------------------
  // Level28 (correct = ★)
  // --------------------------
  {
    level: 28,
    correctShape: "★",
    shapes: [
      { shape: "★", ...coords[1] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[5] },
      { shape: "★", ...coords[8] },
      { shape: "★", ...coords[13] },
      { shape: "★", ...coords[14] },
      { shape: "●", ...coords[0] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[6] },
      { shape: "●", ...coords[15] },
      { shape: "▲", ...coords[4] },
      { shape: "▲", ...coords[7] },
      { shape: "▲", ...coords[9] },
      { shape: "▲", ...coords[12] },
      { shape: "■", ...coords[10] },
      { shape: "■", ...coords[11] },
    ]
  },

  // --------------------------
  // Level29 (correct = ▲)
  // --------------------------
  {
    level: 29,
    correctShape: "▲",
    shapes: [
      { shape: "▲", ...coords[0] },
      { shape: "▲", ...coords[3] },
      { shape: "▲", ...coords[5] },
      { shape: "▲", ...coords[10] },
      { shape: "▲", ...coords[13] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[1] },
      { shape: "■", ...coords[6] },
      { shape: "■", ...coords[8] },
      { shape: "■", ...coords[12] },
      { shape: "★", ...coords[2] },
      { shape: "★", ...coords[4] },
      { shape: "★", ...coords[7] },
      { shape: "★", ...coords[9] },
      { shape: "●", ...coords[11] },
      { shape: "●", ...coords[14] },
    ]
  },


  // --------------------------
  // Level30 (correct = ●)
  // --------------------------
  {
    level: 30,
    correctShape: "●",
    shapes: [
      { shape: "●", ...coords[2] },
      { shape: "●", ...coords[3] },
      { shape: "●", ...coords[5] },
      { shape: "●", ...coords[7] },
      { shape: "●", ...coords[12] },
      { shape: "●", ...coords[13] },
      { shape: "▲", ...coords[1] },
      { shape: "▲", ...coords[6] },
      { shape: "▲", ...coords[8] },
      { shape: "▲", ...coords[15] },
      { shape: "■", ...coords[0] },
      { shape: "■", ...coords[4] },
      { shape: "■", ...coords[9] },
      { shape: "■", ...coords[11] },
      { shape: "★", ...coords[10] },
      { shape: "★", ...coords[14] },
    ]
  },

///////////////////////////////////////////////////////////////
// ここから Level31～50 (diff=1) : (5,4,4,3)
///////////////////////////////////////////////////////////////


// レベル31: correct="■" (5,4,4,3)
{
  level: 31,
  correctShape: "■",
  shapes: [
    // "■" => [1,2,3,10,15]
    { shape: "■", ...coords[0] },   // index=1
    { shape: "■", ...coords[1] },   // index=2
    { shape: "■", ...coords[2] },   // index=3
    { shape: "■", ...coords[9] },   // index=10
    { shape: "■", ...coords[14] },  // index=15

    // "★" => [4,7,9,11]
    { shape: "★", ...coords[3] },   // index=4
    { shape: "★", ...coords[6] },   // index=7
    { shape: "★", ...coords[8] },   // index=9
    { shape: "★", ...coords[10] },  // index=11

    // "●" => [5,8,12,14]
    { shape: "●", ...coords[4] },   // index=5
    { shape: "●", ...coords[7] },   // index=8
    { shape: "●", ...coords[11] },  // index=12
    { shape: "●", ...coords[13] },  // index=14

    // "▲" => [6,13,16]
    { shape: "▲", ...coords[5] },   // index=6
    { shape: "▲", ...coords[12] },  // index=13
    { shape: "▲", ...coords[15] },  // index=16
  ]
},

// レベル32: correct="●"
{
  level: 32,
  correctShape: "●",
  shapes: [
    // "●" => [1,3,7,9,14]
    { shape: "●", ...coords[0] },   // index=1
    { shape: "●", ...coords[2] },   // index=3
    { shape: "●", ...coords[6] },   // index=7
    { shape: "●", ...coords[8] },   // index=9
    { shape: "●", ...coords[13] },  // index=14

    // "▲" => [2,5,8,10]
    { shape: "▲", ...coords[1] },   // index=2
    { shape: "▲", ...coords[4] },   // index=5
    { shape: "▲", ...coords[7] },   // index=8
    { shape: "▲", ...coords[9] },   // index=10

    // "■" => [4,6,11,13]
    { shape: "■", ...coords[3] },   // index=4
    { shape: "■", ...coords[5] },   // index=6
    { shape: "■", ...coords[10] },  // index=11
    { shape: "■", ...coords[12] },  // index=13

    // "★" => [12,15,16]
    { shape: "★", ...coords[11] },  // index=12
    { shape: "★", ...coords[14] },  // index=15
    { shape: "★", ...coords[15] },  // index=16
  ]
},

// レベル33: correct="★"
{
  level: 33,
  correctShape: "★",
  shapes: [
    // "★" => [2,4,6,10,15]
    { shape: "★", ...coords[1] },   // index=2
    { shape: "★", ...coords[3] },   // index=4
    { shape: "★", ...coords[5] },   // index=6
    { shape: "★", ...coords[9] },   // index=10
    { shape: "★", ...coords[14] },  // index=15

    // "●" => [1,5,8,14]
    { shape: "●", ...coords[0] },   // index=1
    { shape: "●", ...coords[4] },   // index=5
    { shape: "●", ...coords[7] },   // index=8
    { shape: "●", ...coords[13] },  // index=14

    // "▲" => [3,7,9,12]
    { shape: "▲", ...coords[2] },   // index=3
    { shape: "▲", ...coords[6] },   // index=7
    { shape: "▲", ...coords[8] },   // index=9
    { shape: "▲", ...coords[11] },  // index=12

    // "■" => [11,13,16]
    { shape: "■", ...coords[10] },  // index=11
    { shape: "■", ...coords[12] },  // index=13
    { shape: "■", ...coords[15] },  // index=16
  ]
},

// レベル34: correct="▲"
{
  level: 34,
  correctShape: "▲",
  shapes: [
    // "▲" => [1,4,6,8,14]
    { shape: "▲", ...coords[0] },   // index=1
    { shape: "▲", ...coords[3] },   // index=4
    { shape: "▲", ...coords[5] },   // index=6
    { shape: "▲", ...coords[7] },   // index=8
    { shape: "▲", ...coords[13] },  // index=14

    // "■" => [2,5,9,12]
    { shape: "■", ...coords[1] },   // index=2
    { shape: "■", ...coords[4] },   // index=5
    { shape: "■", ...coords[8] },   // index=9
    { shape: "■", ...coords[11] },  // index=12

    // "★" => [3,7,10,15]
    { shape: "★", ...coords[2] },   // index=3
    { shape: "★", ...coords[6] },   // index=7
    { shape: "★", ...coords[9] },   // index=10
    { shape: "★", ...coords[14] },  // index=15

    // "●" => [11,13,16]
    { shape: "●", ...coords[10] },  // index=11
    { shape: "●", ...coords[12] },  // index=13
    { shape: "●", ...coords[15] },  // index=16
  ]
},


// -----------------------------------------------------------
// Level35 (correct=■) : 同じ(5,4,4,3)パターン
// -----------------------------------------------------------
{
  level: 35,
  correctShape: "■",
  shapes: [
    { shape: "■", ...coords[0] },  // [1,2,3,10,15]
    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[2] },
    { shape: "■", ...coords[9] },
    { shape: "■", ...coords[14] },

    { shape: "★", ...coords[3] },  // [4,7,9,11]
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[8] },
    { shape: "★", ...coords[10] },

    { shape: "●", ...coords[4] },  // [5,8,12,14]
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[11] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[5] },  // [6,13,16]
    { shape: "▲", ...coords[12] },
    { shape: "▲", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level36 (correct=●)
// -----------------------------------------------------------
{
  level: 36,
  correctShape: "●",
  shapes: [
    // "●" => [1,3,7,9,14]
    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[2] },
    { shape: "●", ...coords[6] },
    { shape: "●", ...coords[8] },
    { shape: "●", ...coords[13] },

    // "▲" => [2,5,8,10]
    { shape: "▲", ...coords[1] },
    { shape: "▲", ...coords[4] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[9] },

    // "■" => [4,6,11,13]
    { shape: "■", ...coords[3] },
    { shape: "■", ...coords[5] },
    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },

    // "★" => [12,15,16]
    { shape: "★", ...coords[11] },
    { shape: "★", ...coords[14] },
    { shape: "★", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level37 (correct=★)
// -----------------------------------------------------------
{
  level: 37,
  correctShape: "★",
  shapes: [
    { shape: "★", ...coords[1] },  // [2,4,6,10,15]
    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[5] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[0] },  // [1,5,8,14]
    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[2] },  // [3,7,9,12]
    { shape: "▲", ...coords[6] },
    { shape: "▲", ...coords[8] },
    { shape: "▲", ...coords[11] },

    { shape: "■", ...coords[10] }, // [11,13,16]
    { shape: "■", ...coords[12] },
    { shape: "■", ...coords[15] },
  ]
},



// -----------------------------------------------------------
// Level38 (correct=▲)
// -----------------------------------------------------------
{
  level: 38,
  correctShape: "▲",
  shapes: [
    { shape: "▲", ...coords[0] },  // [1,4,6,8,14]
    { shape: "▲", ...coords[3] },
    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[13] },

    { shape: "■", ...coords[1] },  // [2,5,9,12]
    { shape: "■", ...coords[4] },
    { shape: "■", ...coords[8] },
    { shape: "■", ...coords[11] },

    { shape: "★", ...coords[2] },  // [3,7,10,15]
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[10] }, // [11,13,16]
    { shape: "●", ...coords[12] },
    { shape: "●", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level39 (correct=●)
// -----------------------------------------------------------
{
  level: 39,
  correctShape: "●",
  shapes: [
    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[2] },
    { shape: "●", ...coords[6] },
    { shape: "●", ...coords[8] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[1] },
    { shape: "▲", ...coords[4] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[9] },

    { shape: "■", ...coords[3] },
    { shape: "■", ...coords[5] },
    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },

    { shape: "★", ...coords[11] },
    { shape: "★", ...coords[14] },
    { shape: "★", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level40 (correct=■)
// -----------------------------------------------------------
{
  level: 40,
  correctShape: "■",
  shapes: [
    { shape: "■", ...coords[0] },
    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[2] },
    { shape: "■", ...coords[9] },
    { shape: "■", ...coords[14] },

    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[8] },
    { shape: "★", ...coords[10] },

    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[11] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[12] },
    { shape: "▲", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level41 (correct=★)
// -----------------------------------------------------------
{
  level: 41,
  correctShape: "★",
  shapes: [
    { shape: "★", ...coords[1] },
    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[5] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[2] },
    { shape: "▲", ...coords[6] },
    { shape: "▲", ...coords[8] },
    { shape: "▲", ...coords[11] },

    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },
    { shape: "■", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level42 (correct=▲)
// -----------------------------------------------------------
{
  level: 42,
  correctShape: "▲",
  shapes: [
    { shape: "▲", ...coords[0] },
    { shape: "▲", ...coords[3] },
    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[13] },

    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[4] },
    { shape: "■", ...coords[8] },
    { shape: "■", ...coords[11] },

    { shape: "★", ...coords[2] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[10] },
    { shape: "●", ...coords[12] },
    { shape: "●", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level43 (correct=■)
// -----------------------------------------------------------
{
  level: 43,
  correctShape: "■",
  shapes: [
    { shape: "■", ...coords[0] },
    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[2] },
    { shape: "■", ...coords[9] },
    { shape: "■", ...coords[14] },

    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[8] },
    { shape: "★", ...coords[10] },

    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[11] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[12] },
    { shape: "▲", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level44 (correct=●)
// -----------------------------------------------------------
{
  level: 44,
  correctShape: "●",
  shapes: [
    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[2] },
    { shape: "●", ...coords[6] },
    { shape: "●", ...coords[8] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[1] },
    { shape: "▲", ...coords[4] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[9] },

    { shape: "■", ...coords[3] },
    { shape: "■", ...coords[5] },
    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },

    { shape: "★", ...coords[11] },
    { shape: "★", ...coords[14] },
    { shape: "★", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level45 (correct=★)
// -----------------------------------------------------------
{
  level: 45,
  correctShape: "★",
  shapes: [
    { shape: "★", ...coords[1] },
    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[5] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[2] },
    { shape: "▲", ...coords[6] },
    { shape: "▲", ...coords[8] },
    { shape: "▲", ...coords[11] },

    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },
    { shape: "■", ...coords[15] },
  ]
},


// -----------------------------------------------------------
// Level46 (correct=▲)
// -----------------------------------------------------------
{
  level: 46,
  correctShape: "▲",
  shapes: [
    { shape: "▲", ...coords[0] },
    { shape: "▲", ...coords[3] },
    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[13] },

    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[4] },
    { shape: "■", ...coords[8] },
    { shape: "■", ...coords[11] },

    { shape: "★", ...coords[2] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[10] },
    { shape: "●", ...coords[12] },
    { shape: "●", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level47 (correct=■)
// -----------------------------------------------------------
{
  level: 47,
  correctShape: "■",
  shapes: [
    { shape: "■", ...coords[0] },
    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[2] },
    { shape: "■", ...coords[9] },
    { shape: "■", ...coords[14] },

    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[8] },
    { shape: "★", ...coords[10] },

    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[11] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[12] },
    { shape: "▲", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level48 (correct=●)
// -----------------------------------------------------------
{
  level: 48,
  correctShape: "●",
  shapes: [
    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[2] },
    { shape: "●", ...coords[6] },
    { shape: "●", ...coords[8] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[1] },
    { shape: "▲", ...coords[4] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[9] },

    { shape: "■", ...coords[3] },
    { shape: "■", ...coords[5] },
    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },

    { shape: "★", ...coords[11] },
    { shape: "★", ...coords[14] },
    { shape: "★", ...coords[15] },
  ]
},

// -----------------------------------------------------------
// Level49 (correct=★)
// -----------------------------------------------------------
{
  level: 49,
  correctShape: "★",
  shapes: [
    { shape: "★", ...coords[1] },
    { shape: "★", ...coords[3] },
    { shape: "★", ...coords[5] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[0] },
    { shape: "●", ...coords[4] },
    { shape: "●", ...coords[7] },
    { shape: "●", ...coords[13] },

    { shape: "▲", ...coords[2] },
    { shape: "▲", ...coords[6] },
    { shape: "▲", ...coords[8] },
    { shape: "▲", ...coords[11] },

    { shape: "■", ...coords[10] },
    { shape: "■", ...coords[12] },
    { shape: "■", ...coords[15] },
  ]
},


// -----------------------------------------------------------
// Level50 (correct=▲)
// -----------------------------------------------------------
{
  level: 50,
  correctShape: "▲",
  shapes: [
    { shape: "▲", ...coords[0] },
    { shape: "▲", ...coords[3] },
    { shape: "▲", ...coords[5] },
    { shape: "▲", ...coords[7] },
    { shape: "▲", ...coords[13] },

    { shape: "■", ...coords[1] },
    { shape: "■", ...coords[4] },
    { shape: "■", ...coords[8] },
    { shape: "■", ...coords[11] },

    { shape: "★", ...coords[2] },
    { shape: "★", ...coords[6] },
    { shape: "★", ...coords[9] },
    { shape: "★", ...coords[14] },

    { shape: "●", ...coords[10] },
    { shape: "●", ...coords[12] },
    { shape: "●", ...coords[15] },
  ]
},
];


  /* ================================
     イベントリスナー
  =================================*/
  startBtn.addEventListener('click', () => startSession());
  restartBtn.addEventListener('click', () => {
    endSession(true); // 強制終了
    startScreen.style.display = 'block';
    restartBtn.style.display = 'none';
  });

  // GoodUIの形ボタン
  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      if (!sessionActive || isBadUI) return;
      const selectedShape = btn.getAttribute('data-shape');
      processShapeSelection(selectedShape);
    });
  });

  // BadUI
  answerBtn.addEventListener('click', () => {
    if (!sessionActive) return;
    openBadUIModal();
  });

  // ハンバーガーメニュー
  hamburgerMenuBtn.addEventListener('click', () => {
    menuPanel.classList.toggle('open');
  });
  closeMenuBtn.addEventListener('click', () => {
    menuPanel.classList.remove('open');
  });
  toggleUIBtn.addEventListener('click', () => {
    isBadUI = !isBadUI;
    updateUIVisibility();
  });

  // CSV
  csvDownloadBtn.addEventListener('click', () => downloadCSV());

  /* ================================
     セッション開始
  =================================*/
  function startSession() {
    startScreen.style.display = 'none';

    sessionActive = true;
    sessionData.playCount++;
    sessionData.sessionStart = new Date();
    currentLevel = 1;
    sessionData.levels = [];

    // 時間取得
    let totalSeconds = parseInt(playTimeInput.value, 10) || 180;
    startTimer(totalSeconds);

    startPuzzle();

    csvDownloadBtn.style.display = 'none';
    restartBtn.style.display = 'block';
  }

  /* ================================
     タイマー開始
  =================================*/
  function startTimer(seconds) {
    let remaining = seconds;
    updateTimerDisplay(remaining);

    timerInterval = setInterval(() => {
      remaining--;
      updateTimerDisplay(remaining);
      if (remaining <= 0) {
        clearInterval(timerInterval);
        endSession(false); // 時間切れ
      }
    }, 1000);
  }

  function updateTimerDisplay(seconds) {
    const min = Math.floor(seconds / 60);
    const sec = seconds % 60;
    timerDisplay.textContent = `Remaining: ${min}:${sec < 10 ? '0' : ''}${sec}`;
  }

  /* ================================
     Puzzle開始（固定データを配置）
  =================================*/
  function startPuzzle() {
    if (!sessionActive) return;

    // 既存の図形を削除
    puzzleArea.querySelectorAll('.shape').forEach(el => el.remove());

    levelDisplay.textContent = `Level ${currentLevel} / ${totalLevels}`;
    levelStartTime = Date.now();

    // レベルの問題取得
    if (currentLevel - 1 < puzzleData.length) {
      const puzzle = puzzleData[currentLevel - 1];
      correctShape = puzzle.correctShape;

      // shapes を配置 (#puzzle-area内)
      puzzle.shapes.forEach(obj => {
        const shapeDiv = document.createElement('div');
        shapeDiv.classList.add('shape');
        shapeDiv.textContent = obj.shape;
        shapeDiv.style.left = obj.x + "px";
        shapeDiv.style.top  = obj.y + "px";
        puzzleArea.appendChild(shapeDiv);
      });
    } else {
      // データが尽きたら終了
      endSession(false);
      return;
    }

    // UI表示を反映
    updateUIVisibility();
  }

  /* ================================
     UIモード切り替え
  =================================*/
  function updateUIVisibility() {
    if (isBadUI) {
      document.getElementById('button-container').style.display = 'none';
      baduiAnswerContainer.style.display = 'block';
    } else {
      document.getElementById('button-container').style.display = 'flex';
      baduiAnswerContainer.style.display = 'none';
    }
  }

  /* ================================
     BadUI: モーダルで形選択
  =================================*/
  function openBadUIModal() {
    const shapeArray = shuffleArray([...SHAPES]);
    baduiShapeContainer.innerHTML = '';

    shapeArray.forEach(s => {
      const btn = document.createElement('button');
      btn.classList.add('badui-shape-btn');
      if (s === "●" || s === "■") {
        btn.classList.add('font16');
      } else {
        btn.classList.add('font12');
      }
      btn.textContent = s;
      btn.addEventListener('click', () => {
        showConfirmUI(s);
      });
      baduiShapeContainer.appendChild(btn);
    });

    confirmContainer.style.display = 'none';
    modalOverlay.style.display = 'flex';
  }

  function showConfirmUI(selectedShape) {
    [...baduiShapeContainer.querySelectorAll('button')].forEach(b => {
      b.disabled = true;
    });
    confirmContainer.style.display = 'block';

    const confirmBtns = confirmContainer.querySelectorAll('.confirm-btn');
    const arrayBtns = Array.from(confirmBtns);
    shuffleArray(arrayBtns);

    // 並べ替え
    confirmContainer.appendChild(arrayBtns[0]);
    confirmContainer.appendChild(arrayBtns[1]);
    confirmContainer.appendChild(arrayBtns[2]);

    // ランダムに1つハイライト
    arrayBtns.forEach(b => b.classList.remove('highlight'));
    const randomIndex = Math.floor(Math.random() * arrayBtns.length);
    arrayBtns[randomIndex].classList.add('highlight');

    arrayBtns.forEach(btn => {
      btn.onclick = () => {
        const choice = btn.getAttribute('data-choice');
        if (choice === 'go') {
          closeModal();
          processShapeSelection(selectedShape);
        } else if (choice === 'no' || choice === 'return') {
          closeModal();
        }
      };
    });
  }

  function closeModal() {
    modalOverlay.style.display = 'none';
  }

  /* ================================
     形の最終選択を判定
  =================================*/
  function processShapeSelection(selectedShape) {
    if (!sessionActive) return;

    // 一致判定
    if (selectedShape === correctShape) {
      // 正解
      const clearTime = Date.now() - levelStartTime;
      sessionData.levels.push({
        level: currentLevel,
        clearTime: clearTime,
        mode: isBadUI ? "BadUI" : "GoodUI"
      });

      if (!isBadUI) showToast("⭕️");

      // 次へ or 終了
      if (currentLevel < totalLevels) {
        currentLevel++;
        startPuzzle();
      } else {
        endSession(false);
      }
    } else {
      // 不正解
      if (!isBadUI) showToast("❌");
    }
  }

  /* ================================
     セッション終了
  =================================*/
  function endSession(isForceEnd) {
    clearInterval(timerInterval);
    timerInterval = null;
    sessionActive = false;

    puzzleArea.querySelectorAll('.shape').forEach(el => el.remove());

    if (!isForceEnd) {
      // 時間切れ or 全レベル終了
      sessionData.sessionEnd = new Date();
      alert("Session Ended");
      csvDownloadBtn.style.display = 'block';
    } else {
      // 強制終了
      sessionData.sessionEnd = new Date();
    }
  }

  /* ================================
     CSV生成 & ダウンロード
  =================================*/
  function downloadCSV() {
    let csv = "Play Count,Session Start,Session End\n";
    csv += `${sessionData.playCount},${sessionData.sessionStart ? sessionData.sessionStart.toISOString() : ""},${sessionData.sessionEnd ? sessionData.sessionEnd.toISOString() : ""}\n\n`;
    csv += "Level,Clear Time (ms),UIMode\n";
    sessionData.levels.forEach(levelData => {
      csv += `${levelData.level},${levelData.clearTime},${levelData.mode}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `session_${sessionData.sessionStart ? sessionData.sessionStart.toISOString() : "noTime"}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  }

  /* ================================
     トースト通知 (GoodUIのみ)
  =================================*/
  function showToast(icon) {
    toast.textContent = icon;
    toast.style.display = 'block';
    setTimeout(() => {
      toast.style.display = 'none';
    }, 1500);
  }

  /* ================================
     ユーティリティ
  =================================*/
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }
</script>
</body>
</html>
